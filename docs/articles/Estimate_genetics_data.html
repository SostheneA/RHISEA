<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Genetic assignment to Mixed-Stock Analysis with RHISEA â€¢ RHISEA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Genetic assignment to Mixed-Stock Analysis with RHISEA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RHISEA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/RHISEA_comprehensive_Guide.html">Comprehensive Guide to the RHISEA Package for Mixed-Stock Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/RHISEA_vs_Fortran.html">Verifying compatibility: RHISEA (R) vs FORTRAN HISEA</a></li>
    <li><a class="dropdown-item" href="../articles/Custom_Classification_Models.html">Applying HISEA estimators to custom classification models with run_hisea_estimates</a></li>
    <li><a class="dropdown-item" href="../articles/Multiple_Classifiers.html">Comparing built-in classification methods in RHISEA for mixed-stock analysis</a></li>
    <li><a class="dropdown-item" href="../articles/RHISEA_data_type.html">Two input paths in RHISEA: run_hisea_all with HISEA-style files or Dataframes</a></li>
    <li><a class="dropdown-item" href="../articles/complex_mixed_stocks.html">Analyzing complex mixed-stock fisheries with 20 stocks</a></li>
    <li><a class="dropdown-item" href="../articles/Estimate_genetics_data.html">Genetic assignment to Mixed-Stock Analysis with RHISEA</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/SostheneA/RHISEA" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Genetic assignment to Mixed-Stock Analysis with RHISEA</h1>
                        <h4 data-toc-skip class="author">Sosthene
Akia</h4>
            <address class="author_afil">
      Fisheries and Oceans
Canada<br><a class="author_email" href="mailto:#"></a><a href="mailto:sosthene.akia@dfo-mpo.ca" class="email">sosthene.akia@dfo-mpo.ca</a>
      </address>
                              <h4 data-toc-skip class="author">Alex
Hanke</h4>
            <address class="author_afil">
      Fisheries and Oceans
Canada<br><a class="author_email" href="mailto:#"></a><a href="mailto:alex.hanke@dfo-mpo.ca" class="email">alex.hanke@dfo-mpo.ca</a>
      </address>
                  
            <h4 data-toc-skip class="date">2025-12-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SostheneA/RHISEA/blob/HEAD/vignettes/Estimate_genetics_data.Rmd"><code>vignettes/Estimate_genetics_data.Rmd</code></a></small>
      <div class="d-none name"><code>Estimate_genetics_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial illustrates how to integrate individual-level genetic
assignment results into RHISEA to estimate mixed-stock proportions. It
uses genotype data in GENEPOP format, processed with adegenet and
assignPOP, and then feeds assignment probabilities and confusion
matrices to <code><a href="../reference/run_hisea_estimates.html">run_hisea_estimates()</a></code> for population-scale
mixing estimates.</p>
<p>The workflow includes:<br>
- Converting GENEPOP data to an adegenet/assignPOP-compatible
format<br>
- Performing Monte Carlo and K-fold cross-validation for assignment
accuracy<br>
- Generating individual assignment probabilities and confusion
matrices<br>
- Passing these outputs to RHISEA for mixed-stock estimation.</p>
</div>
<div class="section level2">
<h2 id="data-preparation-and-import">Data preparation and import<a class="anchor" aria-label="anchor" href="#data-preparation-and-import"></a>
</h2>
<p>In this section, genotype data in GENEPOP format are read and
filtered, then combined with morphometric data to create an integrated
baseline dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read baseline GENEPOP data and reduce low-variance loci</span></span>
<span><span class="va">YourGenepop</span> <span class="op">&lt;-</span> <span class="fu">read.Genepop</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/simGenepop.txt"</span>,</span>
<span>  pop.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_A"</span>, <span class="st">"pop_B"</span>, <span class="st">"pop_C"</span><span class="op">)</span>,</span>
<span>  haploid <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Converting data format...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Encoding genetic data...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ################ assignPOP v1.3.1 ################</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   A GENEPOP format file was successfully imported!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Imported Data Info: 90 obs. by 1000 loci (diploid)</span></span>
<span><span class="co">#&gt;   Number of pop: 3</span></span>
<span><span class="co">#&gt;   Number of inds (pop_A): 30</span></span>
<span><span class="co">#&gt;   Number of inds (pop_B): 30</span></span>
<span><span class="co">#&gt;   Number of inds (pop_C): 30</span></span>
<span><span class="co">#&gt;   DataMatrix: 90 rows by 2001 columns, with 2000 allele variables</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Data output in a list comprising the following three elements:</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$DataMatrix</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$SampleID</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$LocusName</span></span>
<span></span>
<span><span class="va">YourGenepopRd</span> <span class="op">&lt;-</span> <span class="fu">reduce.allele</span><span class="op">(</span><span class="va">YourGenepop</span>, p <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   New data matrix has created! :)</span></span>
<span><span class="co">#&gt;   New DataMatrix size: 90 rows by 1387 columns</span></span>
<span><span class="co">#&gt;   614 columns (alleles) have been removed</span></span>
<span><span class="co">#&gt;   693 loci remaining</span></span>
<span></span>
<span><span class="co"># Integrate genetic and morphometric data</span></span>
<span><span class="va">YourIntegrateData</span> <span class="op">&lt;-</span> <span class="fu">compile.data</span><span class="op">(</span></span>
<span>  <span class="va">YourGenepopRd</span>,</span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/morphData.csv"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   Import a .CSV file.</span></span>
<span><span class="co">#&gt;   4 additional variables detected.</span></span>
<span><span class="co">#&gt;   Checking variable data type...</span></span>
<span><span class="co">#&gt;    D1.2(integer)   D2.3(integer)   D3.4(integer)   D1.4(integer)  Are they correct? (enter Y/N): </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   New data set created!!</span></span>
<span><span class="co">#&gt;   It has 90 observations by 1391 variables</span></span>
<span><span class="co">#&gt;   including 693 loci(1386 alleles) plus 4 additional variables(4 columns)</span></span>
<span></span>
<span><span class="co"># Import morphometric data</span></span>
<span><span class="va">morphdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/morphData.csv"</span>,</span>
<span>  header <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Population labels are then constructed and appended to the
morphometric dataset, illustrating both character and numeric
encodings.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Population labels as characters</span></span>
<span><span class="va">pop_label_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"pop_A"</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"pop_B"</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"pop_C"</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">morphdf_pop_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">morphdf</span>, pop_label <span class="op">=</span> <span class="va">pop_label_char</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Population labels as numeric factors</span></span>
<span><span class="va">pop_label_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">morphdf_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">morphdf</span>, pop_label <span class="op">=</span> <span class="va">pop_label_num</span><span class="op">)</span></span>
<span><span class="va">morphdf_pop</span><span class="op">$</span><span class="va">pop_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">morphdf_pop</span><span class="op">$</span><span class="va">pop_label</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assignment-cross-validation">Assignment cross-validation<a class="anchor" aria-label="anchor" href="#assignment-cross-validation"></a>
</h2>
<p>Monte Carlo and K-fold cross-validation are used to evaluate
assignment performance for different training proportions and subsets of
loci.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Monte Carlo cross-validation using SVM</span></span>
<span><span class="fu">assign.MC</span><span class="op">(</span></span>
<span>  <span class="va">YourGenepopRd</span>,</span>
<span>  train.inds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  train.loci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  loci.sample <span class="op">=</span> <span class="st">"fst"</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"svm"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"Result-folder/"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Parallel computing is on. Analyzing data using 11 cores/threads of CPU...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Monte-Carlo cross-validation done!!</span></span>
<span><span class="co">#&gt;   360 assignment tests completed!!</span></span>
<span></span>
<span><span class="co"># K-fold cross-validation using LDA</span></span>
<span><span class="fu">assign.kfold</span><span class="op">(</span></span>
<span>  <span class="va">YourGenepopRd</span>,</span>
<span>  k.fold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  train.loci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  loci.sample <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"lda"</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"Result-folder2/"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Parallel computing is on. Analyzing data using 11 cores/threads of CPU...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   K-fold cross-validation done!!</span></span>
<span><span class="co">#&gt;   48 assignment tests completed!!</span></span></code></pre></div>
<p>Cross-validation outputs are summarized to quantify classification
accuracy across scenarios.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">accuMC</span> <span class="op">&lt;-</span> <span class="fu">accuracy.MC</span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"Result-folder/"</span><span class="op">)</span>      <span class="co"># Monte Carlo accuracy</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Correct assignment rates were estimated!!</span></span>
<span><span class="co">#&gt;   A total of 360 assignment tests for 3 pops.</span></span>
<span><span class="co">#&gt;   Results were also saved in a 'Rate_of_360_tests_3_pops.txt' file in the directory.</span></span>
<span><span class="va">accuKF</span> <span class="op">&lt;-</span> <span class="fu">accuracy.kfold</span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"Result-folder2/"</span><span class="op">)</span>  <span class="co"># K-fold accuracy</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Correct assignment rates were estimated!!</span></span>
<span><span class="co">#&gt;   A total of 48 assignment tests for 3 pops.</span></span>
<span><span class="co">#&gt;   Results were also saved in a 'Rate_of_48_tests_3_pops.txt' file in the directory.</span></span>
<span></span>
<span><span class="co"># Quick inspection of accuracy objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">accuMC</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    360 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;  $ train.inds       : Factor w/ 3 levels "0.5","0.7","0.9": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ train.loci       : Factor w/ 4 levels "0.1","0.25","0.5",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ iters            : Factor w/ 30 levels "1","10","11",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.all  : num  0.667 0.511 0.556 0.578 0.556 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_A: num  0.333 0.533 0.467 0.6 0.467 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_B: num  0.6667 0.0667 0.2667 0.2 0.2 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_C: num  1 0.933 0.933 0.933 1 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">accuKF</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    48 obs. of  7 variables:</span></span>
<span><span class="co">#&gt;  $ KF               : Factor w/ 3 levels "3","4","5": 1 1 1 2 2 2 2 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ fold             : Factor w/ 5 levels "1","2","3","4",..: 1 2 3 1 2 3 4 1 2 3 ...</span></span>
<span><span class="co">#&gt;  $ train.loci       : Factor w/ 4 levels "0.1","0.25","0.5",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.all  : num  0.433 0.5 0.667 0.458 0.583 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_A: num  0.4 0.5 0.6 0.25 0.625 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_B: num  0.4 0.4 0.6 0.25 0.375 ...</span></span>
<span><span class="co">#&gt;  $ assign.rate.pop_C: num  0.5 0.6 0.8 0.875 0.75 ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assignment-of-unknown-individuals">Assignment of unknown individuals<a class="anchor" aria-label="anchor" href="#assignment-of-unknown-individuals"></a>
</h2>
<p>Unknown individuals are imported and assigned using both genetic-only
and integrated data with different classifiers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import GENEPOP file for unknown individuals</span></span>
<span><span class="va">YourGenepopUnknown</span> <span class="op">&lt;-</span> <span class="fu">read.Genepop</span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/simGenepopX.txt"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Converting data format...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Encoding genetic data...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ################ assignPOP v1.3.1 ################</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   A GENEPOP format file was successfully imported!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Imported Data Info: 30 obs. by 1000 loci (diploid)</span></span>
<span><span class="co">#&gt;   Number of pop: 1</span></span>
<span><span class="co">#&gt;   Number of inds (pop.1): 30</span></span>
<span><span class="co">#&gt;   DataMatrix: 30 rows by 1835 columns, with 1834 allele variables</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Data output in a list comprising the following three elements:</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$DataMatrix</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$SampleID</span></span>
<span><span class="co">#&gt;   YOUR_LIST_NAME$LocusName</span></span>
<span></span>
<span><span class="co"># Integrate genetic and morphometric data for unknowns</span></span>
<span><span class="va">YourIntegrateUnknown</span> <span class="op">&lt;-</span> <span class="fu">compile.data</span><span class="op">(</span></span>
<span>  <span class="va">YourGenepopUnknown</span>,</span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/morphDataX.csv"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   Import a .CSV file.</span></span>
<span><span class="co">#&gt;   4 additional variables detected.</span></span>
<span><span class="co">#&gt;   Checking variable data type...</span></span>
<span><span class="co">#&gt;    D1.2(integer)   D2.3(integer)   D3.4(integer)   D1.4(integer)  Are they correct? (enter Y/N): </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   New data set created!!</span></span>
<span><span class="co">#&gt;   It has 30 observations by 1839 variables</span></span>
<span><span class="co">#&gt;   including 1000 loci(1834 alleles) plus 4 additional variables(4 columns)</span></span>
<span></span>
<span><span class="co"># Non-genetic data only</span></span>
<span><span class="va">NonGeneticUnknown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://raw.githubusercontent.com/alexkychen/assignPOP/master/inst/extdata/morphDataX.csv"</span>,</span>
<span>  header <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Two assignment models are illustrated: naive Bayes using genetic data
and a decision tree using integrated data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Assignment using genetic data and naive Bayes</span></span>
<span><span class="fu">assign.X</span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="va">YourGenepopRd</span>,</span>
<span>  x2 <span class="op">=</span> <span class="va">YourGenepopUnknown</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"Result-folder3/"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"naiveBayes"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Known and unknown datasets have unequal features.</span></span>
<span><span class="co">#&gt;   Automatically identify common features between datasets...</span></span>
<span><span class="co">#&gt;    1375 features are used for assignment.</span></span>
<span><span class="co">#&gt;   Performing PCA on genetic data for dimensionality reduction...</span></span>
<span><span class="co">#&gt;   Assignment test is done! See results in your designated folder.</span></span>
<span><span class="co">#&gt;   Predicted populations and probabilities are saved in [AssignmentResult.txt]</span></span></code></pre></div>
<p><img src="Estimate_genetics_data_files/figure-html/assignment_tests_naives_Bayes-1.png" width="672"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. Assignment using integrated data and decision tree</span></span>
<span><span class="fu">assign.X</span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="va">YourIntegrateData</span>,</span>
<span>  x2 <span class="op">=</span> <span class="va">YourIntegrateUnknown</span>,</span>
<span>  dir <span class="op">=</span> <span class="st">"Result-folder4/"</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"tree"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Known and unknown datasets have unequal features.</span></span>
<span><span class="co">#&gt;   Automatically identify common features between datasets...</span></span>
<span><span class="co">#&gt;    1379 features are used for assignment.</span></span>
<span><span class="co">#&gt;   Performing PCA on concatenated genetic and non-genetic data...</span></span>
<span><span class="co">#&gt;   Assignment test is done! See results in your designated folder.</span></span>
<span><span class="co">#&gt;   Predicted populations and probabilities are saved in [AssignmentResult.txt]</span></span></code></pre></div>
<p><img src="Estimate_genetics_data_files/figure-html/assignment_tests_decision_tree-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="from-assignment-matrices-to-rhisea-inputs">From assignment matrices to RHISEA inputs<a class="anchor" aria-label="anchor" href="#from-assignment-matrices-to-rhisea-inputs"></a>
</h2>
<p>assignPOP can produce a membership matrix for individuals, and RHISEA
requires a misclassification (phi) matrix describing baseline stock
confusion rates. Here, an example <code>assign.matrix</code> output is
converted to the <code>phi_matrix</code> format expected by
<code><a href="../reference/run_hisea_estimates.html">run_hisea_estimates()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default: read all files in the specified Monte Carlo result folder</span></span>
<span><span class="va">AM</span> <span class="op">&lt;-</span> <span class="fu">assign.matrix</span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"Result-folder/"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Assignment across 360 tests from Monte-Carlo cross-validation.</span></span>
<span><span class="co">#&gt;  Mean </span></span>
<span><span class="co">#&gt;        assignment</span></span>
<span><span class="co">#&gt; origin  pop_A pop_B pop_C</span></span>
<span><span class="co">#&gt;   pop_A  0.56  0.43  0.01</span></span>
<span><span class="co">#&gt;   pop_B  0.38  0.51  0.11</span></span>
<span><span class="co">#&gt;   pop_C  0.03  0.06  0.92</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Standard Deviation </span></span>
<span><span class="co">#&gt;        assignment</span></span>
<span><span class="co">#&gt; origin  pop_A pop_B pop_C</span></span>
<span><span class="co">#&gt;   pop_A  0.25  0.25  0.05</span></span>
<span><span class="co">#&gt;   pop_B  0.25  0.24  0.13</span></span>
<span><span class="co">#&gt;   pop_C  0.07  0.10  0.11</span></span>
<span></span>
<span><span class="co"># Example confusion matrix (phi matrix) constructed from assignment results</span></span>
<span><span class="va">AM_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  origin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_A"</span>, <span class="st">"pop_B"</span>, <span class="st">"pop_C"</span><span class="op">)</span>,</span>
<span>  pop_A  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  pop_B  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.10</span><span class="op">)</span>,</span>
<span>  pop_C  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">AM_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">AM_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">AM_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">AM_df</span><span class="op">$</span><span class="va">origin</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">AM_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">AM_df</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">stocks_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_A"</span>, <span class="st">"pop_B"</span>, <span class="st">"pop_C"</span><span class="op">)</span></span></code></pre></div>
<p>Individual-level assignment probabilities are then extracted from the
decision-tree assignment output and formatted for RHISEA.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read assignment results from integrated-data decision tree model</span></span>
<span><span class="va">LDA_assign</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span></span>
<span>  <span class="fu">readit</span><span class="op">(</span>.data <span class="op">=</span> <span class="st">"Result-folder4/AssignmentResult.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert predicted populations to integer class labels</span></span>
<span><span class="va">LDA_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">LDA_assign</span><span class="op">$</span><span class="va">pred.pop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract assignment probabilities (one column per stock)</span></span>
<span><span class="va">LDA_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">LDA_assign</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mixed-stock-estimation-with-rhisea">Mixed-stock estimation with RHISEA<a class="anchor" aria-label="anchor" href="#mixed-stock-estimation-with-rhisea"></a>
</h2>
<p>Finally, RHISEA is used to convert the individual assignment results
and misclassification matrix into unbiased estimates of stock mixing
proportions using bootstrap resampling.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_LDA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_hisea_estimates.html">run_hisea_estimates</a></span><span class="op">(</span></span>
<span>  pseudo_classes <span class="op">=</span> <span class="va">LDA_classes</span>,</span>
<span>  likelihoods    <span class="op">=</span> <span class="va">LDA_probs</span>,</span>
<span>  phi_matrix     <span class="op">=</span> <span class="va">AM_matrix</span>,</span>
<span>  np             <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  type           <span class="op">=</span> <span class="st">"BOOTSTRAP"</span>,</span>
<span>  stocks_names   <span class="op">=</span> <span class="va">stocks_names</span>,</span>
<span>  export_csv     <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output_dir     <span class="op">=</span> <span class="st">"rf_results_4Mod"</span>,</span>
<span>  verbose        <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results_LDA</span><span class="op">$</span><span class="va">mean_estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt;             RAW       COOK     COOKC           EM        ML</span></span>
<span><span class="co">#&gt; pop_A 0.3340000 -2.3213333 0.1083403 6.744857e-05 0.2809635</span></span>
<span><span class="co">#&gt; pop_B 0.3656667  3.5306667 0.6302499 9.999326e-01 0.4167697</span></span>
<span><span class="co">#&gt; pop_C 0.3003333  0.6333333 0.2614099 0.000000e+00 0.3022668</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results_LDA</span><span class="op">$</span><span class="va">sd_estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt;              RAW     COOK     COOKC           EM         ML</span></span>
<span><span class="co">#&gt; pop_A 0.08349234 4.815653 0.2648184 0.0008091922 0.08644330</span></span>
<span><span class="co">#&gt; pop_B 0.08920801 5.567898 0.4656863 0.0008091922 0.10049481</span></span>
<span><span class="co">#&gt; pop_C 0.08618188 2.995381 0.3936336 0.0000000000 0.09596643</span></span></code></pre></div>
<p>This workflow demonstrates how genetic classification output from an
external, widely used assignment framework (for example, individual
probability classification with the assignPOP package) can be directly
integrated into RHISEA, enabling mixed-stock estimation that explicitly
accounts for both assignment uncertainty and baseline
misclassification.</p>
<p>This highlights the adaptive capacity of RHISEA and shows that the
package can flexibly incorporate different genetic assignment pipelines
without imposing restrictive assumptions on how individual probabilities
are generated.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sosthene Akia, Alex Hanke.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
